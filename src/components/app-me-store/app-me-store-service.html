<!--
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../app-store.html">

<!--
`<Name>` is Description

@element Name
-->
<dom-module id="app-me-store-service">
  
  <script>
      class AppMeStoreService extends ReduxMixin(Polymer.Element) {

          static get is() {
              return 'app-me-store-service';
          }

          static get properties() {
              return {
                  env: {
                      type: Object,
                      statePath: 'env',
                      observer: 'init'
                  },
              }
          }

          static get observers() {
              return []
          }

          static get listeners() {
              return []
          }

          constructor() {
              super();
          }

          init() {
              if(this.firstLoad) return;
              
              this.tunnel = document.createElement('iron-ajax');
              this.tunnel.headers = {
                  Authorization : `Bearer ${this.env.token}`,
                  Accept: 'application/json'
              };
              this.tunnel.contentType = 'application/json';
              
              Polymer.RenderStatus.afterNextRender(this, function () {
                  document.addEventListener('product-upload', (e) => this._uploadProduct(e));
                  document.addEventListener('product-update', (e) => this._uploadProduct(e));
              });
              this.firstLoad = true;
          }

          _uploadProduct(event){
              'Lets save this product';
              console.log(event);
          }
      }

      window.customElements.define(AppMeStoreService.is, AppMeStoreService);
  </script>
</dom-module>
