<link rel="import" href="../bower_components/polymer-redux/polymer-redux.html">
<link rel="import" href="constants.html">
<link rel="import" href="components/app-env/app-env.html">

<script>
	const initialState = {
		app: {
			env: {
		    	app_domain: env.app_domain,
		        production: env.production,
		     	clientSecret: env.clientSecret,
		        clientId: env.clientId,
		        token: ''
			},
			busy: false
		},
		user: null,
		products: []

	}

	//App Namespace
	const App = {};

	// App Reducer 
	App.reducer =  (state = null, action) => {
		if(!state) return initialState;

		switch(action.type){
			case C.SET_USER:
				return App.setUser(state, action); break;
			case C.SET_APP_BUSY:
				return App.setBusy(state, action); break;
			case C.SET_USER_TOKEN:
				return App.setToken(state, action); break;
			default:
			return state;
		}
	}
	
	/*
	 * sets the current user object.
	 * @param {state, action}
	 */
	App.setUser = (state = null, action) => Object.assign({}, state, {
        user: action.payload
  	});

	/*
	 * sets the current user object.
	 * @param {state, action}
	 */
	App.setBusy = (state = null, action) => {
		return {
			...state,
	        app: { 
	        	...state.app, 
	        	busy: action.payload
	        }
    	}
  	};

	/*
	 * sets the current user object.
	 * @param {state, action}
	 */
	App.setToken = (state = null, action) => {
		return {
			...state,
	        app: { 
	        	...state.app, 
	        	env: {
	        		...state.app.env,
	        		token: action.payload
	        	}
	        }
    	}
  	};

	const store = Redux.createStore(App.reducer);
	const ReduxMixin = PolymerRedux(store);
</script>